<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Gravitational Simulation</title>
<style>
<!--
p
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.Citation
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:2.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	font-style:italic}
p.CitationAuthor
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif"}
h1
	{margin-top:40.0pt;
	margin-right:17.85pt;
	margin-bottom:30.0pt;
	margin-left:0cm;
	text-align:right;
	line-height:70%;
	page-break-after:avoid;
	font-size:30.0pt;
	font-family:"Georgia","serif";
	font-variant:small-caps;
	font-weight:bold}
span.Heading1mycislo
	{font-family:"Georgia","serif";
	color:#999999;
	position:relative;
	top:-30.0pt}
p.Para
	{margin:6.0pt 0cm; text-align:justify;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif"}
span.MsoFootnoteReference
	{}
p.Heading2my
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	font-weight:bold}
p.Paraequation
	{margin:6.0pt 0cm; text-align:center;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif"}
h3
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	line-height:115%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria","serif";
	font-weight:bold}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{mso-style-name:"Caption\,'Char Char'";
	mso-style-link:'Caption Char\','Char Char Char';
	margin-top:0cm;
	margin-right:14.2pt;
	margin-bottom:10.0pt;
	margin-left:14.2pt;
	text-align:justify;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold}
span.StylTituleknenTunChar
	{font-family:"Times New Roman","serif"}
 p.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
-->
</style>
</head>

<body>

<p class="Citation"><span lang="EN-US">“All motion is an illusion.”</span></p>

<p class="CitationAuthor"><span lang="EN-US">— Zeno of Elea (5th century BCE) —</span></p>

<h1 style="margin-left:21.6pt;text-indent:-21.6pt"><span class="Heading1mycislo"><span style="font-size:160.0pt;line-height:70%" lang="EN-US">4</span></span><span style="font-variant:normal !important;text-transform:uppercase" lang="EN-US"><br>
<a name="_Toc164912036"></a><a name="_Toc163286825"></a><a name="_Ref160883663"></a><a name="_Ref160883654"></a><a name="_Toc160882672">Gravitational Simulation</a></span></h1>

<p class="Para"><span lang="EN-US">How separate stars in a galaxy interact? In this
chapter, I will show how to simulate the effect of a gravitational field and of
  Newton’s laws of motion to move stars (simplified to mass bodies) around. The
method is referred to as many-body problem, particle simulation, <i>N</i>-body
simulation, <i>N</i>-particle simulation or <i>N</i>-body problem<a href="#_ftn33" name="_ftnref33" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:
115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[33]</span></span></a>.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912037"></a><a name="_Toc163286826"></a><a name="_Ref161467753"></a><a name="_Toc160882673"><span lang="EN-US">4.1<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span lang="EN-US">N</span></i><span lang="EN-US">-body problem</span></a></p>

<p class="Para"><span lang="EN-US">Dynamics is interested in more than a pure
description of motion. Dynamics is a study of how a system of bodies evolves over
time under the presence of force. Bodies are represented by mass particles (or
mass points) that are under the influence of force. The <i>N</i><b><span style="text-transform:uppercase">-</span></b>body simulation is used to
determine the evolution of <i>N</i><b><span style="text-transform:uppercase">-</span></b>body
system.</span></p>

<p class="Para"><span lang="EN-US">The <i>N-</i>body simulations can be used in
theoretical studies of the large-scale structure of the universe, galaxies,
star clusters, solar systems, stellar dynamics, climate modeling, gases,
liquids and plasmas. On smaller scales, quantum effects become important. <i>N</i>-body
simulations are applied in a wide range of areas outside physics such as <i>N</i>-body
simulations of large biomolecules, for example realistic protein unfolding or
even simulations of deoxyribonucleic acid (DNA). The <i>N-</i>body simulation
has proven to be one of the most versatile methods.</span></p>

<p class="Para"><span lang="EN-US">The <i>N-</i>body problem is defined as follows.
We have initial conditions i.e. initial positions and initial velocities of all
bodies in the system. Interactions (forces) between all bodies in the system have
to be evaluated to receive new positions and new velocities. This evaluation is
performed repeatedly so that we are getting information about the time
evolution of the system.</span></p>

<p class="Para"><span lang="EN-US">Mathematically is the <i>N</i>-body problem formulated
by the system of ordinary differential equations (ODE) coming from Newton’s laws of motion expressed as</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:12.0pt"><img src="Gravitational%20Simulation_files/image008.png" height="42" width="62"></span></span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref155075035"><span lang="EN-US">(</span></a><span lang="EN-US">4.1)</span></p>
  </td>
 </tr>
 <tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:12.0pt"><img src="Gravitational%20Simulation_files/image009.png" height="41" width="89"></span>,</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160861849"><span lang="EN-US">(</span></a><span lang="EN-US">4.2)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">where <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image010.png" height="17" width="21"></span>, <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image011.png" height="23" width="14"></span>&nbsp;and <span style="position:
relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image012.png" height="23" width="15"></span>&nbsp;are the mass, position and
velocity of the <i>i</i>-th particle, respectively, and <span style="position:
relative;top:9.0pt"><img src="Gravitational%20Simulation_files/image013.png" height="26" width="97"></span>. The force <span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image014.png" height="27" width="19"></span>&nbsp;is usually the sum of
external forces. When dealing with molecules, Lennard-Jones force, van der
Waals force or Coulomb’s electrostatic force is used. When dealing with systems
of stars or stellar systems, we will use Newton’s gravitational force<a href="#_ftn34" name="_ftnref34" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:
115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[34]</span></span></a>.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912038"></a><a name="_Toc163286827"></a><a name="_Toc160882674"><span lang="EN-US">4.2<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Gravitational <i>N</i>-body problem</span></a></p>

<p class="Para"><span lang="EN-US">Galaxies are controlled by the force of gravity
that acts between all bodies except of self-interaction. First, we will look
onto a straightforward application of Newton’s law of gravity and then on a complex
hierarchical approximation.</span></p>

<p class="Para"><span lang="EN-US">Gravity interaction between all pairs of bodies (except
of self-interaction) will introduce a sum to the right side of Equation (4.2) and will become</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:26.0pt"><img src="Gravitational%20Simulation_files/image015.png" height="61" width="118"></span>.</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref161810750"><span lang="EN-US">(</span></a><span lang="EN-US">4.3)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">A force <span style="position:relative;
top:7.0pt"><img src="Gravitational%20Simulation_files/image016.png" height="28" width="20"></span>&nbsp;given
by Newton’s universal law of gravitaty, is given by</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:17.0pt"><img src="Gravitational%20Simulation_files/image017.png" height="51" width="126"></span>,</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160881887"><span lang="EN-US">(</span></a><span lang="EN-US">4.4)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">where <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image018.png" height="19" width="17"></span>&nbsp;is Newton’s gravitational constant, <span style="position:relative;top:9.0pt"><img src="Gravitational%20Simulation_files/image019.png" height="26" width="100"></span>, <span style="position:relative;top:7.0pt"><img src="Gravitational%20Simulation_files/image020.png" height="25" width="78"></span>&nbsp;and&nbsp;<span style="position:relative;top:8.0pt"><img src="Gravitational%20Simulation_files/image021.png" height="29" width="85"></span>. </span></p>

<p class="Para"><span lang="EN-US">After plugging a term for the velocity <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image022.png" height="23" width="16"></span>&nbsp;(Eq. 4.1) to the left side
of Eq. (4.2), Equation 4.4 is
simplified to a&nbsp;form, where the acceleration <span style="position:relative;
top:12.0pt"><img src="Gravitational%20Simulation_files/image023.png" height="43" width="31"></span>&nbsp;is
independent on the mass of selected body <i>i</i></span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><img src="Gravitational%20Simulation_files/image024.png" height="61" width="197">.</p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160864520"><span lang="EN-US">(</span></a><span lang="EN-US">4.5)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">A dynamical evolution of the system composed of <i>N</i>
bodies under the influence of gravity is not solvable to exact solution for
more than two bodies<a href="#_ftn35" name="_ftnref35" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[35]</span></span></a>.
Therefore, a numerical approach is required to study this problem.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912039"></a><a name="_Toc163286828"></a><a name="_Toc160882675"><span lang="EN-US">4.3<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Numerical techniques for solving ODEs</span></a></p>

<p class="Para"><span lang="EN-US">The new position and new velocity of <i>i-</i>th
body must be calculated from the known acceleration. Equation (4.5) contains second derivatives and it is
therefore second-order differential equation. However, all higher-order
differential equations can be transformed into a set of first-order
differential equations (e.g. Press et al., 2002). In our case, Equation (4.5) can be rewritten as two first-order
differential equations by introducing a new variable <span style="position:
relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image025.png" height="23" width="16"></span>&nbsp;as follows</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image026.png" height="105" width="150"></span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160865096"><span lang="EN-US">(</span></a><span lang="EN-US">4.6)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">As can be seen, the variable <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image025.png" height="23" width="16"></span>&nbsp;is the velocity. We already
had both equations (4.6) in (4.1) and (4.3). However, many problems in
computational physics are described by a second order differential equation and
it is useful to know, how they can be semi-automatically reduced to the set of
first-order differential equations. This transformation corresponds in
theoretical mechanics to the Hamiltonian form of equations of motion.</span></p>

<h3 style="margin-left:36.0pt;text-indent:-36.0pt"><a name="_Toc164912040"></a><a name="_Toc163286829"></a><a name="_Toc160882676"><span lang="EN-US">4.3.1<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp; </span>Euler’s method</span></a></h3>

<p class="Para"><span lang="EN-US">We describe laws of physics with continuous
variables and differential equations like Eq. (4.6). However, we must somehow convert
these mathematical equations into a numerical form suitable for a limited
arithmetic of a digital computer. We have to solve differential equations by the
numerical approximation. Let us have some continuous function <b><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image027.png" height="21" width="33"></span>&nbsp;</b>in one-dimension and its
numerical representation as shown on Figure 4–1.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span style="position:absolute;z-index:20;left:0px;margin-left:113px;margin-top:119px;
width:18px;height:13px"><img src="Gravitational%20Simulation_files/image028.png" height="13" width="18"></span><span lang="EN-US"><img src="Gravitational%20Simulation_files/image029.png" height="197" width="492">&nbsp;</span></p>

<p class="MsoCaption"><span lang="EN-US">Figure 4–1: </span><span style="font-weight:
normal" lang="EN-US">A</span><span lang="EN-US"> </span><span style="font-weight:
normal" lang="EN-US">f</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">unction </span></span><span style="font-weight:normal" lang="EN-US"><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image027.png" height="21" width="33"></span></span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">&nbsp;tabulated
at discrete time instants </span></span><span style="font-weight:
normal" lang="EN-US"><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image030.png" height="20" width="65"></span>&nbsp;</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">as values
</span></span><span style="font-weight:normal" lang="EN-US"><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image031.png" height="17" width="76"></span>&nbsp;with timestep <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image032.png" height="17" width="25"></span></span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">.</span></span></p>

<p class="Para"><span lang="EN-US">Starting from an initial discrete value <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image033.png" height="17" width="18"></span>, we can calculate a following
function value <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image034.png" height="17" width="18"></span>&nbsp;using the equation
for the derivative of a function. The derivative <b><span style="position:relative;
top:5.0pt"><img src="Gravitational%20Simulation_files/image035.png" height="23" width="37"></span>&nbsp;</b>of
the function <b><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image027.png" height="21" width="33"></span>&nbsp;</b>at a given
point <b><span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image036.png" height="16" width="11"></span></b>&nbsp;is equal to the slope of
the function <b><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image027.png" height="21" width="33"></span>&nbsp;</b>that is
tangent to the function at that given point. It is formally defined as</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:12.0pt"><img src="Gravitational%20Simulation_files/image037.png" height="43" width="203"></span>.</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><span lang="EN-US">(4.7)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">Here we will approximate the limit by taking
some small, but finite <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image032.png" height="17" width="25"></span>&nbsp;rather than
mathematically letting it go to zero. Through this very small interval
(timestep) <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image032.png" height="17" width="25"></span>, a good approximation to the
underlying differential equation is achieved. The derivative at the starting
point of each interval is linearly extrapolated to find the next function
value. We assume that the derivative remains constant in the interval between <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image038.png" height="20" width="15"></span>&nbsp;and <span style="position:
relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image039.png" height="20" width="14"></span>. Therefore, in order to
solve ODE and find the value <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image034.png" height="17" width="18"></span>&nbsp;at the &nbsp;point
<span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image039.png" height="20" width="14"></span>, we need to know the initial
value <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image033.png" height="17" width="18"></span>&nbsp;at the point <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image038.png" height="20" width="15"></span>. This problem involving ODE
is therefore specified not only by its equations, but also by the initial value
and therefore is called <i>the</i> <i>initial value problem<a href="#_ftn36" name="_ftnref36" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><b><span style="font-size:12.0pt;
line-height:115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[36]</span></b></span></a></i>.
Consequently, an approximate solution to the differential equation is given by the
initial value and the scheme</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:7.0pt"><img src="Gravitational%20Simulation_files/image040.png" height="27" width="176"></span>,</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160868104"><span lang="EN-US">(</span></a><span lang="EN-US">4.8)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">where <span style="position:relative;top:12.0pt"><img src="Gravitational%20Simulation_files/image041.png" height="40" width="98"></span>. Second
term on the right side of Equation (4.8) <span style="position:relative;
top:7.0pt"><img src="Gravitational%20Simulation_files/image042.png" height="27" width="87"></span>&nbsp;is
the first term of series in the Taylor expansion of <span style="position:relative;
top:5.0pt"><img src="Gravitational%20Simulation_files/image043.png" height="21" width="30"></span>&nbsp;about
<span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image044.png" height="20" width="14"></span>. This scheme for numerically
approximating the solution of ODE invented Leonhard Euler<a href="#_ftn37" name="_ftnref37" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:
115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[37]</span></span></a>.</span></p>

<p class="Para"><span lang="EN-US">We must now apply Euler’s scheme to equations (4.6) and finally compute the new position
and new velocity of the <i>i</i>-th body. When we consider the change of <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image045.png" height="17" width="14"></span>&nbsp;to <span style="position:
relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image046.png" height="17" width="18"></span>&nbsp;we can express the increments
of the position and velocity as</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:5.0pt"><img src="Gravitational%20Simulation_files/image047.png" height="23" width="96"></span>,</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160868517"><span lang="EN-US">(</span></a><span lang="EN-US">4.9)</span></p>
  </td>
 </tr>
 <tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span><img src="Gravitational%20Simulation_files/image048.png" height="59" width="169"></span>.</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160868506"><span lang="EN-US">(</span></a><span lang="EN-US">4.10)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">With certain initial conditions this will
ultimately change to</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:441.3pt;padding:0cm 5.4pt 0cm 5.4pt" width="588">
  <p class="Paraequation"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image049.png" height="85" width="222"></span></p>
  </td>
  <td style="width:39.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="53">
  <p class="Paraequation"><span lang="EN-US">(4.11)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">where <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image050.png" height="26" width="37"></span>, <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image051.png" height="26" width="36"></span>&nbsp;are new values of velocity
and position of <i>i</i>-th body and <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image052.png" height="26" width="27"></span>, <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image053.png" height="26" width="25"></span>&nbsp;are previous values of
velocity and position of <i>i</i>-th body, respectively.</span></p>

<h3 style="margin-left:36.0pt;text-indent:-36.0pt"><a name="_Toc164912041"></a><a name="_Toc163286830"></a><a name="_Toc160882677"><span lang="EN-US">4.3.2<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp; </span>Midpoint method</span></a></h3>

<p class="Para"><span lang="EN-US">Although Euler’s method is cheap to compute, it
is not very desirable for practical purposes, due to its inaccuracy when
compared to other methods. These methods use more points and higher derivatives
to get a better estimate of the derivation in the point of interest, which is
paid off by the requirement of more computational power.</span></p>

<p class="Para"><span lang="EN-US">Nevertheless, we can improve Euler’s method, so
that it is much more accurate and that its computational cost is only slightly
higher. This method uses derivatives computed at the midpoint of each step. In
addition, it avoids the need for computing second derivative. Moreover, the midpoint
method is very well suited for second-order differential systems of type <span style="position:relative;top:12.0pt"><img src="Gravitational%20Simulation_files/image054.png" height="43" width="99"></span>&nbsp;by design and is therefore
suitable for <i>N</i>-body problem solutions.</span></p>

<p class="Para"><span lang="EN-US">The extra actions taken to prepare the system
for midpoint method are the prediction of the position of body <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image055.png" height="23" width="15"></span>&nbsp;at the middle of the
timestep <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image032.png" height="17" width="25"></span>&nbsp;according to</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:12.0pt"><img src="Gravitational%20Simulation_files/image056.png" height="42" width="167"></span></span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><span lang="EN-US">(4.12)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">and the acceleration based on this positions at <span style="position:relative;top:7.0pt"><img src="Gravitational%20Simulation_files/image057.png" height="39" width="75"></span>&nbsp;computed as</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:444.85pt;padding:0cm 5.4pt 0cm 5.4pt" width="593">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:26.0pt"><img src="Gravitational%20Simulation_files/image058.png" height="61" width="151"></span>.</span></p>
  </td>
  <td style="width:33.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="45">
  <p class="Paraequation"><a name="_Ref160870613"><span lang="EN-US">(</span></a><span lang="EN-US">4.13)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">Then the <i>i</i>-th particle is advanced
according to</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:441.3pt;padding:0cm 5.4pt 0cm 5.4pt" width="588">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:5.0pt"><img src="Gravitational%20Simulation_files/image059.png" height="31" width="170"></span>,</span></p>
  </td>
  <td style="width:39.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="53">
  <p class="Paraequation"><span lang="EN-US">(4.14)</span></p>
  </td>
 </tr>
 <tr>
  <td style="width:441.3pt;padding:0cm 5.4pt 0cm 5.4pt" width="588">
  <p class="Paraequation"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="position:
  relative;top:12.0pt"><img src="Gravitational%20Simulation_files/image060.png" height="42" width="235"></span>.</span></p>
  </td>
  <td style="width:39.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="53">
  <p class="Paraequation"><span lang="EN-US">(4.15)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">Velocities are one-half of the timestep out of
synchrony with positions.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image061.png" height="141" width="561"></span></p>

<p class="MsoCaption"><span lang="EN-US">Figure 4–2: </span><span style="font-weight:
normal" lang="EN-US">The e</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">valuation of position in the midpoint method is
looking like a jumping frog. Therefore, this method is also called the leapfrog.</span></span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912042"></a><a name="_Toc163286831"></a><a name="_Toc160882678"><span lang="EN-US">4.4<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Methods for solving galactic <i>N</i>-body
problem</span></a></p>

<p class="Para"><span lang="EN-US">To solve the <i>N</i>–body problem for large <i>N</i>,
we must look at the efficiency of a computer solution to be sure that
simulation time will not be prohibitive. An algorithm’s efficiency can be
evaluated through the number of computations that must be carried out in order
to solve a given problem. Usually, it is impossible to exactly predict the number
of operations performed by a computer, because it depends on exactly what a machine
or language implementation is being used. Therefore we generally use the “big&nbsp;O”
notation to generalize a computational complexity (“the speed of a program”). The
computational complexity usually depends on the size <i>n </i>of the input data
<span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image062.png" height="24" width="60"></span>.</span></p>

<p class="Para"><span lang="EN-US">Ideally, a dynamical evolution of a galaxy would
be modeled with a direct <i>N</i>-body simulation. In the framework of the
direct <i>N</i>-body simulation, each body interacts with <span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image063.png" height="24" width="55"></span>&nbsp;other bodies. The
interactions must be carried out for each of the <i>N</i> bodies. To compute the
accelerations (4.13) for each
of the <i>N</i> bodies, the direct algorithm must summate over <span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image063.png" height="24" width="55"></span>&nbsp;bodies. In order to evaluate
force interactions of the system composed of the <i>N </i>bodies, <span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image064.png" height="24" width="79"></span>&nbsp;computations are needed;
that is nearly <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image065.png" height="20" width="37"></span>&nbsp;computations. For a
galaxy with <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image066.png" height="20" width="30"></span>stars, <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image067.png" height="20" width="30"></span>&nbsp;computations
 are needed. To
study evolutionary stages of such galaxy, we will need at least tens of
thousands of such timesteps. Of course, it is possible to use third 
Newton’s law of motion, which holds that “to every action there is 
always opposed an equal
reaction” (Newton, 1687). This reduces the number of required 
computations to a
half, i.e. <span style="position:relative;top:12.0pt"><img src="Gravitational%20Simulation_files/image068.png" height="41" width="73"></span>. However, computational
complexity is still <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image069.png" height="24" width="49"></span>. It means that the
number of computations is approaching <span style="position:relative;
top:3.0pt"><img src="Gravitational%20Simulation_files/image070.png" height="21" width="40"></span>,
where <i>c</i> is some constant. This direct (brute-force) computation provides
a high accuracy for the price of huge time complexity. Therefore, number of bodies
that can be simulated is dramatically limited.</span></p>

<p class="Para"><span lang="EN-US">General-purpose computers are becoming more
advanced so that <i>N</i>-body simulations can account with more and more
bodies. Computations on a graphics card in personal computer with a high
processing speed called GPGPU (General-Purpose computation on Graphics
Processing Units) are becoming available. Single-purpose computers like GRAPE
(built around specialized pipeline processors, literally “GRAvity PipE”)
introduced in 1990 and computers with FPGA (Field Programmable Gate Array) are
increasing a widespread usage and the accuracy of <i>N</i>-body simulations.</span></p>

<p class="Para"><span lang="EN-US">Advancement not only in the power of computer
hardware, but also in the development of sophisticated algorithms made possible
studies of large systems of bodies like galaxies or galaxy groups. Still, the gravitational
influence is long reaching. Therefore, it is impossible to neglect in
computations bodies behind some spatial distance. However, astronomical systems
have properties that can be utilized in designing “faster” computational
methods. These methods lead to the reduction of required differential equations
that must be solved in order to obtain new positions and velocities of bodies
in the modeled system. A small error is introduced in exchange for a large
speedup.</span></p>

<p class="Para"><span lang="EN-US">A lot of methods for a faster simulation of
gravitational force was invented. However, it is possible to divide them into
two basic groups.</span></p>

<p class="Para" style="margin-left:18.0pt;text-indent:-18.0pt"><span style="font-family:Symbol" lang="EN-US">·<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="EN-US">Methods based on finite differences, finite
elements, grid or mesh methods, Eulerian codes – e.g. particle in cell (PIC), particle-mesh
(PM), particle-particle/particle mesh (P3M) – computes even in regions with a low
number of bodies, grid density same everywhere even in areas without bodies, geometrical
restriction, useful mainly for homogenous particle distributions. Used from
1960s: forces are evaluated in each of the cell of the grid; fast Fourier
Transform (FFT) is then used to solve the gravitational potential from a density
distribution interpolated onto a regular mesh.</span></p>

<p class="Para" style="margin-left:18.0pt;text-indent:-18.0pt"><span style="font-family:Symbol" lang="EN-US">·<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-family:CMSY10" lang="EN-US">M</span><span lang="EN-US">ethods based on a particle system, grid-less methods, Lagrangian
codes – adaptive for non-homogenous particle distributions without the loss of
speed, does not waste time in regions with a low number of bodies. Invented in
1980s. Tree methods: Once a tree is built, it can be re-used as an efficient
search method for other physics such as smoothed particle hydrodynamics (SPH).</span></p>

<p class="Para"><span lang="EN-US">State-of-the-art simulation codes like GADGET-2
(Springel, 2005) combine both techniques into a single hybrid code.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912043"></a><a name="_Toc163286832"></a><a name="_Toc160882679"><span lang="EN-US">4.5<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Hierarchical approach to <i>N</i>-body problem</span></a></p>

<p class="Para"><span lang="EN-US">How can we find out the gravitational influence
of the galaxy M31 in the constellation of Andromeda<a href="#_ftn38" name="_ftnref38" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:
115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[38]</span></span></a> to
the Earth? The number of stars in the Andromeda galaxy is of order <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image071.png" height="20" width="29"></span>. If we look at this galaxy
on the night sky, we cannot distinguish its individual stars, because of the great
distance of 730 kpc; we see it as a patch of light. The same physical intuition
can be applied to the gravity. If we are computing the gravitational influence
of the distant Andromeda galaxy, we can substitute the whole Andromeda with a single
mass point, which position will be located at the center of mass of that galaxy
(see Figure 4–3).</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image072.png" height="305" width="462"></span></p>

<p class="MsoCaption"><a name="_Ref160875401"></a><a name="_Ref160875406"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–3: </span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">Gravitational potential of the distant
system of bodies approximated as the potential of a single body.</span></span></p>

<p class="Para"><span lang="EN-US">Barnes and Hut (1986) introduced such a method
for solving <i>N</i>-body problem that requires less computation than the direct
<i>N</i>-body method. The gravitational influence of distant bodies can be
combined into a single group so that the whole group acts as a single body.
This method is called the Barnes-Hut algorithm, tree-code, or hierarchical
tree-code.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912044"></a><a name="_Toc163286833"></a><a name="_Toc160882680"><span lang="EN-US">4.6<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Building tree hierarchy, space decomposition</span></a></p>

<p class="Para"><span lang="EN-US">A basic computer structure representing a physical
spatial distribution of bodies in a space is a tree. The root of the tree (overall
simulated volume) encompasses all bodies in the simulated system. The tree is
constructed from the root by splitting the simulated volume into rectangular
cubes (cells, domains). In three dimensions, the division of the parent cube
into eight daughterly cubes (potential new nodes) constructs every node of the
tree. The tree structure is therefore called octal-tree or simply oct-tree. The
division is accomplished by splitting each of the Cartesian dimension to a half.
This repeatedly continues until the cube contains more than one body. If there
is only one body in the cube left, it is stored as a leaf in the tree
structure. When the cube is empty, it is ignored. The tree is composed of a hierarchical
arrangement of leaves, nodes and the root (top-most node) (Figure 4–4). The leave
represents the mass point itself, in the hierarchy is on the lowest position. The
tree is usually reconstructed during every timestep.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image073.png" height="312" width="606"></span></p>

<p class="MsoCaption"><span lang="EN-US">Figure 4–4: </span><span style="font-weight:
normal" lang="EN-US">A</span><span lang="EN-US"> </span><span style="font-weight:
normal" lang="EN-US">t</span><span style="font-weight:normal" lang="EN-US">wo-</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">dimensional
simulation volume with stars is divided to four areas (left). A related
quad-tree (right) is constructed in a clockwise pass starting at the
bottom-right red square of the simulation volume. Empty squares of the simulated
volume are ignored in the tree and are illustrated as transparent circles
connected with dotted branches to the parent node.</span></span></p>

<p class="Para"><span lang="EN-US">The tree method is suitable for astronomical
systems. It is adaptive to a non-homogenous distribution of bodies, because it
automatically adjusts to the particle distribution. In the case of uniform distribution,
the tree has the same depth everywhere. On contrary, in a typical galaxy with
more stars in the center, the tree is automatically deeper at the center and shallower
on the edge (see Figure 4–5).
This is the source of troubles for simulations with grid-based codes.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image074.png" height="371" width="610"></span></p>

<p class="MsoCaption"><a name="_Ref160875724"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–5: </span><span style="font-weight:
normal" lang="EN-US">Galaxy-like (left) and uniform (right) distributions. The adaptability
of the tree method is very useful in galaxy calculations with a highly varying
particle distribution.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912045"></a><a name="_Toc163286834"></a><a name="_Toc160882681"><span lang="EN-US">4.7<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Division of space with Hilbert’s space-filling
curve</span></a></p>

<p class="Para"><span lang="EN-US">The simulated volume can be optionally divided
by a space-filling curve<a href="#_ftn39" name="_ftnref39" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[39]</span></span></a>.
The space-filling curve completely fills up the simulated volume by passing
through the every point of simulated volume. It is physically meaningful to
divide the simulated volume continuously.</span></p>

<p class="Para"><span lang="EN-US">Hilbert’s curve in 2D can be constructed
recursively starting with an&nbsp; initial curve <span style="position:relative;
top:6.0pt"><img src="Gravitational%20Simulation_files/image075.png" height="25" width="22"></span>.
We can identify orientations of the curve <span style="position:relative;
top:6.0pt"><img src="Gravitational%20Simulation_files/image075.png" height="25" width="22"></span>&nbsp;with
numbers (1), (2), and (3) (see Figure 4–6). The subsequent curve scheme is determined by the previous through
replacing both (1) with the smaller version of the same orientation of the scheme
and by replacing ends (2, 3) with rotated and mirrored versions of the scheme.
On the next level is applied the same algorithm on each part of the previous scheme.</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:119.3pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image076.png" height="141" width="141"></span></p>
  </td>
  <td style="width:119.3pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image077.png" height="141" width="141"></span></p>
  </td>
  <td style="width:119.35pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image078.png" height="141" width="140"></span></p>
  </td>
  <td style="width:119.35pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image079.png" height="141" width="141"></span></p>
  </td>
 </tr>
 <tr>
  <td style="width:119.3pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image075.png" height="25" width="22"></span>, level 0</span></p>
  </td>
  <td style="width:119.3pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image080.png" height="23" width="19"></span>, level 1</span></p>
  </td>
  <td style="width:119.35pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image081.png" height="23" width="22"></span>, level 2</span></p>
  </td>
  <td style="width:119.35pt;padding:0cm 5.4pt 0cm 5.4pt" valign="top" width="159">
  <p class="Para" style="text-align:center" align="center"><span lang="EN-US"><span style="position:relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image082.png" height="25" width="20"></span>, level 3</span></p>
  </td>
 </tr>
</tbody></table>

<p class="MsoCaption"><a name="_Ref160877083"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–6: </span><span style="font-weight:
normal" lang="EN-US">Pattern of Hilbert’s curve in two dimensions.</span></p>

<p class="Para"><span lang="EN-US">In three dimensions, Hilbert’s curve copying is somewhat
more complicated. Again, the subsequent orientation of Hilbert’s curve can be
determined from its predecessor through a rotation. Let us define the initial
orientation of Hilbert’s curve (level 0) as on Figure 4–7. In the following step (level 1),
the cube will be divided and traversed with Hilbert’s curve in a way marked in Figure 4–8.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image083.png" height="416" width="393"></span></p>

<p class="MsoCaption"><a name="_Ref160878519"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–7: </span><span style="font-weight:
normal" lang="EN-US">The initial orientation of Hilbert’s curve (level 0, root cube) in the three-dimensional
simulated volume. The division of this cube will construct level 1 of the oct-tree
in a marked way.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image084.png" height="429" width="391"></span></p>

<p class="MsoCaption"><a name="_Ref160878859"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–8: </span><span style="font-weight:
normal" lang="EN-US">Level 1 division of the three-dimensional Hilbert’s curve.</span></p>

<p class="MsoNormal"><span style="font-size:3.0pt;line-height:115%" lang="EN-US">&nbsp;</span></p>

<p class="Para"><span lang="EN-US">Rules for copying to the subsequent step are now
following. Initial Hilbert’s curve (level 0) will be rotated as follows:</span></p>

<p class="MsoNormal"><span lang="EN-US">1. Rotate around <i>y</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image085.png" height="19" width="39"></span>&nbsp;and around <i>x</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>.</span></p>

<p class="MsoNormal"><span lang="EN-US">2. Rotate around <i>y</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>&nbsp;and around <i>z</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>.</span></p>

<p class="MsoNormal"><span lang="EN-US">3. Same as (2).</span></p>

<p class="MsoNormal"><span lang="EN-US">4. Rotate around <i>x</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image087.png" height="19" width="46"></span>.</span></p>

<p class="MsoNormal"><span lang="EN-US">5. Same as (4).</span></p>

<p class="MsoNormal"><span lang="EN-US">6. Rotate around <i>y</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image085.png" height="19" width="39"></span>&nbsp;and around <i>z</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image085.png" height="19" width="39"></span>.</span></p>

<p class="MsoNormal"><span lang="EN-US">7. Same as (6).</span></p>

<p class="MsoNormal"><span lang="EN-US">8. Rotate around <i>y</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>&nbsp;and around <i>x</i>-axis by <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>.</span></p>

<div align="center">

<table class="MsoNormalTable" style="width:472.0pt;border-collapse:collapse" border="0" cellpadding="0" cellspacing="0" width="629">
 <tbody><tr>
  <td style="width:95.4pt;padding:0cm 5.4pt 0cm 5.4pt" width="127">
  <p class="MsoNormal" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image088.png" height="122" width="104"></span></p>
  </td>
  <td style="width:99.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="132">
  <p class="MsoNormal" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image089.png" height="123" width="102"></span></p>
  </td>
  <td style="width:99.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="132">
  <p class="MsoNormal" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image090.png" height="125" width="106"></span></p>
  </td>
  <td style="width:84.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="113">
  <p class="MsoNormal" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image091.png" height="123" width="97"></span></p>
  </td>
  <td style="width:93.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="125">
  <p class="MsoNormal" style="text-align:center" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image092.png" height="124" width="99"></span></p>
  </td>
 </tr>
 <tr>
  <td style="width:95.4pt;padding:0cm 5.4pt 0cm 5.4pt" width="127">
  <p class="MsoNormal" style="text-align:center" align="center"><i><span lang="EN-US">y</span></i><span lang="EN-US"> <span style="position:relative;
  top:3.0pt"><img src="Gravitational%20Simulation_files/image085.png" height="19" width="39"></span>,
  <br>
  <i>x</i> <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span></span></p>
  </td>
  <td style="width:99.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="132">
  <p class="MsoNormal" style="text-align:center" align="center"><i><span lang="EN-US">y</span></i><span lang="EN-US"> <span style="position:relative;
  top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>,
  <br>
  <i>z</i> <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span></span></p>
  </td>
  <td style="width:99.0pt;padding:0cm 5.4pt 0cm 5.4pt" width="132">
  <p class="MsoNormal" style="text-align:center" align="center"><i><span lang="EN-US">x</span></i><span lang="EN-US"> <span style="position:relative;
  top:3.0pt"><img src="Gravitational%20Simulation_files/image087.png" height="19" width="46"></span></span></p>
  </td>
  <td style="width:84.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="113">
  <p class="MsoNormal" style="text-align:center" align="center"><i><span lang="EN-US">y</span></i><span lang="EN-US"> <span style="position:relative;
  top:3.0pt"><img src="Gravitational%20Simulation_files/image085.png" height="19" width="39"></span>,
  <br>
  <i>z</i> <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image085.png" height="19" width="39"></span></span></p>
  </td>
  <td style="width:93.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="125">
  <p class="MsoNormal" style="text-align:center" align="center"><i><span lang="EN-US">y</span></i><span lang="EN-US"> <span style="position:relative;
  top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span>,
  <br>
  <i>x</i> <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image086.png" height="19" width="39"></span></span></p>
  </td>
 </tr>
</tbody></table>

</div>

<p class="MsoCaption"><span lang="EN-US">Figure 4–9: </span><span style="font-weight:
normal" lang="EN-US">The traversal of the simulated volume by Hilbert’s curve.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912046"></a><a name="_Toc163286835"></a><a name="_Toc160882682"><span lang="EN-US">4.8<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Computing centers of mass</span></a></p>

<p class="Para"><span lang="EN-US">Every node contains information describing a mass
distribution of bodies that fall within this node. Once the tree construction
phase is finished, information about a position, velocity and total mass of node’s
descendants is computed and stored into each node. This calculation is
performed in one pass from leaves to the root. For higher accuracy, quadruple
or higher order moments should be also computed. However, such calculations lead
to higher requirements on a simulation time and computational slowdown.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><a name="_Toc164912047"></a><a name="_Toc163286836"></a><a name="_Toc160882683"><span lang="EN-US">4.9<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Force evaluation</span></a></p>

<p class="Para"><span lang="EN-US">The pass through the tree from its root computes
force acting on every single body in the system. It will take the body from the
current node (for the first time, it is the root node) and it will receive its descendant
(nodes or leaves from one of eight possible sub-nodes of the root). If the
center of mass of the current node is sufficiently distant from the selected
body, the force is computed as the force acting between the selected individual
body and the node. This is the heart of the speed-up of force computations.</span></p>

<p class="Para"><span lang="EN-US">If the distance between the selected body and
the node (its center of mass) is not sufficient then the node is “opened” and a
distance check is performed between all of its leaves or sub-nodes and the selected
body (see Figure 4–10). This is
executed repeatedly. The worst-case scenario is that the algorithm will dig-down
all the way from the root to individual leaves (individual bodies) and the
computational complexity will be the same as in the case of the direct <i>N</i>-body
simulation.</span></p>

<p class="Para"><span lang="EN-US">When is the node “sufficiently distant”? A criterion
determining sufficient distance is a <i>multipole acceptability criterion or
MAC. </i>Barnes and Hut (1986) introduced criterion</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td width="588">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:12.0pt"><img src="Gravitational%20Simulation_files/image093.png"></span>,</span></p>
  </td>
  <td style="width:39.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="53">
  <p class="Paraequation"><span lang="EN-US">(4.16)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">where <i>d</i> is the distance between the selected
body and the mass center of node, <i>l </i>is the length of cube’s edge (see Figure 4–11) and <span style="position:relative;
top:2.0pt"><img src="Gravitational%20Simulation_files/image094.png" height="17" width="13"></span>&nbsp;is
the opening angle. Parameter <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image094.png" height="17" width="13"></span>&nbsp;determines
the speed-up of the algorithm and accuracy at the same time. It is suggested to
choose this parameter in the range <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image095.png" height="21" width="81"></span>&nbsp;(Hernquist,
1987). Smaller values of <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image094.png" height="17" width="13"></span>&nbsp;are leading
to the opening of a larger number of nodes, to a better accuracy of force
computation and to computational slow-down.</span></p>

<p class="Para"><span lang="EN-US">&nbsp;</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image096.png" height="291" width="408"></span></p>

<p class="MsoCaption"><a name="_Ref160880164"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–10: </span><span style="font-weight:normal" lang="EN-US">If the distance between the selected body and the
node is sufficient, the computation of force is performed between them.
Otherwise, the distance criterion is applied to all descendants of the node.</span></p>

<p class="Para"><span lang="EN-US">&nbsp;</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image097.png" height="156" width="466"></span></p>

<p class="MsoCaption"><a name="_Ref160880216"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–11: </span><span style="font-weight:normal" lang="EN-US">The</span><span lang="EN-US"> </span><span style="font-weight:normal" lang="EN-US">meaning of parameters <i>d </i>and <i>l</i> in the Barnes-Hut
criterion.</span></p>

<p class="Para"><span lang="EN-US">This approach leads to the reduction of required
interactions and to the decrease of computational complexity to <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image098.png" height="21" width="85"></span>. It is a substantial
improvement over the direct summation method with <b><span style="position:
relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image069.png" height="24" width="49"></span>&nbsp;</b>complexity (see Figure 4–12). To further improve a performance
and reduce a total processor time required for a simulation run, I parallelized
this part with OpenMP<a href="#_ftn40" name="_ftnref40" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[40]</span></span></a>.</span></p>

<p class="Para" style="text-align:center;text-indent:14.2pt;
page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image099.png" height="266" width="461"></span></p>

<p class="MsoCaption"><a name="_Ref160880303"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–12: </span><span style="font-weight:normal" lang="EN-US">A s</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">uperior scaling </span></span><span style="font-weight:normal" lang="EN-US"><span style="position:relative;
top:5.0pt"><img src="Gravitational%20Simulation_files/image100.png" height="21" width="87"></span>&nbsp;</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">of the hierarchical
method for solving the <br>
</span></span><i><span style="font-weight:normal" lang="EN-US">N</span></i><span style="font-weight:normal" lang="EN-US">-body</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">
problem as compared to the direct method with quadratic </span></span><span style="font-weight:normal" lang="EN-US"><span style="position:relative;
top:5.0pt"><img src="Gravitational%20Simulation_files/image101.png" height="24" width="47"></span>&nbsp;</span><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US">complexity.
For the same number </span></span><i><span style="font-weight:normal" lang="EN-US">N</span></i><span class="StylTituleknenTunChar"><span style="font-weight:normal" lang="EN-US"> of
bodies, fewer computations are required with the hierarchical method.</span></span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><span lang="EN-US">4.10<span style="font:7.0pt &quot;Times New Roman&quot;"> </span>&nbsp;&nbsp;<a name="_Toc164912048"></a><a name="_Toc163286837"></a><a name="_Toc160882684">Grouping</a></span></p>

<p class="Para"><span lang="EN-US">Interaction evaluation and MAC testing are
located in the computationally most-intensive part of the algorithm. Therefore,
it is convenient to look for optimizations of this time-critical part of code.
We can suppose that bodies that are spatially close to each other will interact
with the nearly same nodes (Barnes, 1990). We should therefore create groups of
close bodies according to their spatial location. We can utilize cubes (nodes)
produced during the tree construction. When such encompassing cube contains
some limited number of bodies (my simulations used always 32 bodies), we can
call it the group and add this group (cube) into the list of groups. During the
force evaluation, we do not choose the single body; instead we choose the whole
group.</span></p>

<p class="Para"><span lang="EN-US">Nodes or leaves interacting with the selected
group might be split into two lists (Becciani et al., 2000). The first list
contains bodies (nodes or leaves) that are sufficiently distant and affect the group’s
center of mass, and therefore all bodies in the selected group. The second list
contains bodies that are too close and interaction with them must be computed
individually for each body in the group.</span></p>

<p class="Para"><span lang="EN-US">Again, we must introduce some criterion that
will decide to which list should be the node or leave inserted. We can
encompass all bodies in the group with a sphere of radius (Becciani et al.,
2000)</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:441.3pt;padding:0cm 5.4pt 0cm 5.4pt" width="588">
  <p class="Paraequation"><span lang="EN-US"><span style="position:relative;
  top:7.0pt"><img src="Gravitational%20Simulation_files/image102.png" height="25" width="82"></span>,</span></p>
  </td>
  <td style="width:39.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="53">
  <p class="Paraequation"><span lang="EN-US">(4.17)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">where <i>c</i> is a parameter determining an accuracy
and <span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image103.png" height="21" width="15"></span>&nbsp;is the length of the cube’s
edge. If the separation <span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image104.png" height="13" width="12"></span>&nbsp;(see Figure 4–13) between the group’s center of
mass and the distant node is greater than <span style="position:relative;
top:7.0pt"><img src="Gravitational%20Simulation_files/image105.png" height="20" width="36"></span>,
the distant node is inserted to the first list. Otherwise, the distant node is
ascribed to the list of close bodies. Finally, all bodies from the group are
added to the second list.</span></p>

<p class="Para"><span lang="EN-US">Parameter <i>c</i> determines the accuracy and
is chosen to be <span style="position:relative;top:12.0pt"><img src="Gravitational%20Simulation_files/image106.png" height="44" width="73"></span>.</span></p>

<p class="Para" style="text-align:center;page-break-after:avoid" align="center"><span lang="EN-US"><img src="Gravitational%20Simulation_files/image107.png" height="270" width="451"></span></p>

<p class="MsoCaption"><a name="_Ref160881367"><span lang="EN-US">Figure </span></a><span lang="EN-US">4–13: </span><span style="font-weight:normal" lang="EN-US">The m</span><span style="font-weight:
normal" lang="EN-US">eaning of parameters </span><span lang="EN-US"><span style="position:
relative;top:6.0pt"><img src="Gravitational%20Simulation_files/image108.png" height="24" width="16"></span>, <span style="position:relative;
top:7.0pt"><img src="Gravitational%20Simulation_files/image109.png" height="25" width="35"></span>&nbsp;</span><span style="font-weight:normal" lang="EN-US">and <span style="position:relative;
top:3.0pt"><img src="Gravitational%20Simulation_files/image110.png" height="15" width="12"></span>&nbsp;in
the grouping strategy.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><span lang="EN-US">4.11<span style="font:7.0pt &quot;Times New Roman&quot;"> </span>&nbsp;&nbsp;<a name="_Toc164912049"></a><a name="_Toc163286838"></a><a name="_Toc160882685">Exploding galaxies</a></span></p>

<p class="Para"><span lang="EN-US">Galaxies are collisionless systems, which mean
that its components (stars) do not affect each other by close encounters. Orbit
of a single star is affected almost entirely by an overall potential of the whole
galaxy, not by other star that is nearby. On contrary, star clusters are
collisional systems, which mean that also the close encounters of bodies
(stars) are important in computation and paths of individual bodies might be
substantially altered by close passes of neighbors. As the notion suggests, collisional
systems are so dense that stars may eventually get so close to each other that
they may collide. Therefore, star clusters are sometimes called <i>dense
stellar systems</i>. If you are interested in the modeling of dense stellar
systems, read Hut and Makino (2006).</span></p>

<p class="Para"><span lang="EN-US">While using a constant timestep, two bodies can get
very close to each other so that unbearable numerical error is introduced. An
integration with an improperly big timestep (therefore called overstep problem)
might lead to an anomalously high velocity of a body (star), which as a result
leave a gravitationally bound system of bodies. When such encounter occurs in a
numerical simulation, the star is unnaturally accelerated and flies out of the galaxy
(therefore called disk-heating problem). This is a direct effect of discrete
numerical calculations. In differential equation is movement described
continuously and smoothly.</span></p>

<p class="Para"><span lang="EN-US">Close encounters of stars in a real galaxy are improbable
with regard to a low spatial distribution of stars. In order to treat the
galaxy as the collisionless system, bodies <i>i </i>and <i>j </i>in Equation (4.4) should never get close to each other
(not even during the collision of galaxies). Therefore a <i>gravitational
softening (smoothing)</i> must be employed to avoid nonrealistic acceleration
caused by the close encounters (Aarseth, 1963). Small number called a <i>softening
length </i><span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image111.png" height="15" width="13"></span>&nbsp;must be added to the denominator
in Newton’s universal law of gravitation (<span style="position:relative;
top:7.0pt"><img src="Gravitational%20Simulation_files/image112.png" height="20" width="16"></span>&nbsp;is
replaced by <span style="position:relative;top:7.0pt"><img src="Gravitational%20Simulation_files/image113.png" height="22" width="45"></span>). The softening length <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image111.png" height="15" width="13"></span>&nbsp;must be small when compared
to galaxy dimensions. The softening essentially smoothens out microphysics that
cannot be resolved in the simulation. For large distances, the small number <span style="position:relative;top:3.0pt"><img src="Gravitational%20Simulation_files/image111.png" height="15" width="13"></span>&nbsp;has little effect; model is
more collisionless. Stars interact through the customary “softened”
gravitational force where an acceleration <span style="position:relative;
top:6.0pt"><img src="Gravitational%20Simulation_files/image114.png" height="24" width="16"></span>&nbsp;is
expressed as</span></p>

<table class="MsoNormalTable" style="border-collapse:collapse" border="0" cellpadding="0" cellspacing="0">
 <tbody><tr>
  <td style="width:441.3pt;padding:0cm 5.4pt 0cm 5.4pt" width="588">
  <p class="Paraequation"><span lang="EN-US"><span><img src="Gravitational%20Simulation_files/image115.png" height="58" width="204"></span>.</span></p>
  </td>
  <td style="width:39.8pt;padding:0cm 5.4pt 0cm 5.4pt" width="53">
  <p class="Paraequation"><span lang="EN-US">(4.18)</span></p>
  </td>
 </tr>
</tbody></table>

<p class="Para"><span lang="EN-US">A mathematical formulation of the gravitational
force depends on an inverse square of a distance between bodies <i>i</i> and <i>j.
</i>The mass point representing the star is essentially an infinitely deep
potential well that can be expressed as Dirac’s &#948;&#8209;function<a href="#_ftn41" name="_ftnref41" title="" style="font-family: 'Times New Roman',serif; color: blue; text-decoration: underline"><span class="MsoFootnoteReference"><span style="font-size:12.0pt;line-height:
115%;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;" lang="EN-US">[41]</span></span></a> in
the point’s location. When these two bodies are very close to each other <span style="position:relative;top:8.0pt"><img src="Gravitational%20Simulation_files/image116.png" height="29" width="61"></span>, the evaluation of
acceleration together with the large timestep may bring a very large number
that may introduce numerical errors or even lead to infinity. The gravitational
softening will therefore eliminate numerical errors introduced when two bodies
approach each other. Other solution to the close encounter problem is a variable
timestep or cutoff radius, which reduces interaction at short ranges.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><span lang="EN-US">4.12<span style="font:7.0pt &quot;Times New Roman&quot;"> </span>&nbsp;&nbsp;<a name="_Toc164912050"></a><a name="_Toc163286839"></a><a name="_Toc160882686">Code limitation</a>s</span></p>

<p class="Para"><span lang="EN-US">The difference between <b><span style="position:relative;top:5.0pt"><img src="Gravitational%20Simulation_files/image117.png" height="21" width="65"></span>&nbsp;</b>and <b><span style="position:relative;top:2.0pt"><img src="Gravitational%20Simulation_files/image118.png" height="20" width="24"></span></b>&nbsp;is immense and many more
stars can be simulated. Nevertheless, the real galaxies have billions of stars
and realistic simulations of galaxy dynamics will stay unreachable for some
time. The value of <i>N</i> is too large for a simulation where each body
represents the single star. This number is even beyond the power of modern
computers, the speed of existing computers and sophisticated algorithms is still
too limited for the number of bodies. Therefore, each individual particle in
the simulation represents rather a large association of stars.</span></p>

<p class="Para"><span lang="EN-US">On contrary, solar system simulations are
computed with an interest on specific bodies (planets, moons, asteroids,
comets, spaceships) and their particular precise orbit. <i>N</i>-body
simulations of galaxies are more of a statistical nature, they do not testify
about orbits of individual stars. Individual bodies do not represent individual
stars in our galaxy simulation.</span></p>

<p class="Para"><span lang="EN-US">The hierarchical and numerical approximation may
lead to unacceptable errors in the simulation. Errors increases with each
timestep in general. When simulating for several thousand time-steps, these
errors will add up. Whatever code we use, we should test it in analytic limits
where possible. We should compare our simulations with observations from
telescopes and check whether our results are meaningful. We should use our
intuition and ask what the output should be. The computer only does what we
tell it to do, and will happily perform meaningless simulation. With the
impressive power and scope of numerical techniques, we should be always aware
of numerous potential pitfalls. Although remarkably robust, numerical
simulations must be used with care if the results are to be meaningful. When we
start computing, we should be careful and not stop thinking. Yet dynamics in
galaxies is worth of study.</span></p>

<p class="Heading2my" style="margin-left:28.8pt;text-indent:-28.8pt"><span lang="EN-US">4.13<span style="font:7.0pt &quot;Times New Roman&quot;"> </span>&nbsp;&nbsp;<a name="_Toc164912051"></a><a name="_Toc163286840"></a><a name="_Toc160882687">Concluding remarks</a></span></p>

<p class="Para"><span lang="EN-US">In Chapter 4, we have shown how to simulate the
effect of the gravitational field and of Newton’s laws of motion to move the
stars around. I described my implementation of Barnes-Hut algorithm for many-body
simulation and novel geometry-based construction of the 3-dimensional Hilbert’s
curve. Simulation code works in four steps. First, a tree is constructed by
space decomposition from a list of bodies that form the simulated system. Space
is divided utilizing Hilbert’s self-similar space-filling curve. Groups of
close bodies are created. Second, centers of mass of individual nodes are
computed. Third, accelerations are computed with the Barnes-Hut algorithm.
Fourth, new positions and velocities are computed. Thanks to this algorithm,
all simulations will be fully self-consistent, i.e. no rigid potentials will be
employed.</span></p>




</body></html>